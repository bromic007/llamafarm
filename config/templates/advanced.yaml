version: v1
name: advanced-project
namespace: advanced

# =============================================================================
# RUNTIME CONFIGURATION
# =============================================================================
runtime:
  provider: ollama
  model: llama3.1:8b
  base_url: http://localhost:11434/v1  # Note: /v1 for OpenAI compatibility
  temperature: 0.5
  # instructor_mode: json  
  # api_key: optional, not needed for ollama
  # model_api_parameters: optional additional parameters

# =============================================================================
# PROMPTS CONFIGURATION
# =============================================================================
prompts:
  - role: system
    content: |
      You are a helpful AI assistant. 
      
      CRITICAL RULES:
      1. NEVER repeat the user's question as your answer
      2. ALWAYS provide a substantive, helpful response
      3. If you don't know something, say so clearly rather than repeating the question
      
      When RAG context is provided, use it to enhance your answers.
      When no context is available, use your general knowledge.
      
      Remember: Your response must be different from the user's input.

# =============================================================================
# DATASETS CONFIGURATION
# =============================================================================
datasets: []

# =============================================================================
# RAG CONFIGURATION
# =============================================================================
rag:
  # =============================================================================
  # DATABASE CONFIGURATIONS
  # =============================================================================
  databases:
    # Main vector database for general documents
    - name: "main_database"
      type: "ChromaStore"
      config:
        persist_directory: "./data/chroma_db"
        distance_function: "cosine"
        collection_name: "documents"
        port: 8000
      # Default strategies for this database
      default_embedding_strategy: "default_embeddings"
      default_retrieval_strategy: "basic_search"
      # Available embedding strategies
      embedding_strategies:
        - name: "default_embeddings"
          type: "OllamaEmbedder"
          config:
            model: "nomic-embed-text"
            base_url: "http://localhost:11434/"
            dimension: 768
            batch_size: 16
            timeout: 60
            auto_pull: true
        - name: "fast_embeddings"
          type: "OllamaEmbedder"
          config:
            model: "nomic-embed-text"
            base_url: "http://localhost:11434/"
            dimension: 768
            batch_size: 32
            timeout: 30
            auto_pull: true
      # Available retrieval strategies
      retrieval_strategies:
        - name: "basic_search"
          type: "BasicSimilarityStrategy"
          config:
            distance_metric: "cosine"
            top_k: 10
          default: true
        - name: "filtered_search"
          type: "MetadataFilteredStrategy"
          config:
            top_k: 10
            filter_mode: "post"
            fallback_multiplier: 2
        - name: "hybrid_search"
          type: "HybridUniversalStrategy"
          config:
            strategies:
              - type: "BasicSimilarityStrategy"
                weight: 0.6
                config:
                  top_k: 10
                  distance_metric: "cosine"
              - type: "MultiQueryStrategy"
                weight: 0.4
                config:
                  num_queries: 3
                  top_k: 10
                  aggregation_method: "weighted"
            combination_method: "weighted_average"
            final_k: 5
        - name: "reranked_search"
          type: "RerankedStrategy"
          config:
            initial_k: 20
            final_k: 5
            rerank_factors:
              similarity_weight: 0.5
              recency_weight: 0.3
              metadata_weight: 0.2
            normalize_scores: true

    # Specialized database for research papers
    - name: "research_database"
      type: "ChromaStore"
      config:
        persist_directory: "./data/research_db"
        distance_function: "cosine"
        collection_name: "research_papers"
        port: 8001
      default_embedding_strategy: "research_embeddings"
      default_retrieval_strategy: "academic_search"
      embedding_strategies:
        - name: "research_embeddings"
          type: "OllamaEmbedder"
          config:
            model: "nomic-embed-text"
            base_url: "http://localhost:11434/"
            dimension: 768
            batch_size: 8
            timeout: 90
            auto_pull: true
      retrieval_strategies:
        - name: "academic_search"
          type: "BasicSimilarityStrategy"
          config:
            distance_metric: "cosine"
            top_k: 5
          default: true

  # =============================================================================
  # DATA PROCESSING STRATEGIES
  # =============================================================================
  data_processing_strategies:
    # Research papers processing
    - name: "research_papers_processing"
      description: "Optimized strategy for academic research paper analysis"
      # DirectoryParser configuration (ALWAYS ACTIVE)
      directory_config:
        recursive: true
        include_patterns: ["*.pdf", "*.txt", "*.md"]
        exclude_patterns: ["*.tmp", ".*", "__pycache__/*"]
        allowed_extensions: [".pdf", ".txt", ".md", ".markdown"]
        max_files: 1000
        follow_symlinks: false
      parsers:
        - type: "PDFParser_LlamaIndex"
          file_extensions: [".pdf", ".PDF"]
          config:
            chunk_size: 1500
            chunk_overlap: 200
            chunk_strategy: "semantic"
            preserve_equations: true
            extract_images: false
            extract_metadata: true
        - type: "TextParser_Python"
          file_extensions: [".txt", ".text"]
          config:
            chunk_size: 1500
            chunk_overlap: 200
            chunk_strategy: "paragraphs"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: true
            min_chunk_size: 100
            preserve_line_breaks: true
            strip_empty_lines: true
            detect_structure: true
        - type: "MarkdownParser_Python"
          file_extensions: [".md", ".markdown", ".mdown"]
          config:
            chunk_size: 2000
            chunk_overlap: 300
            chunk_strategy: "headings"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: true
            min_chunk_size: 150
      extractors:
        - type: "ContentStatisticsExtractor"
          config:
            include_readability: true
            include_vocabulary: true
            include_structure: true
            include_sentiment_indicators: true
        - type: "EntityExtractor"
          config:
            entity_types: ["PERSON", "ORG", "GPE", "DATE", "PERCENT", "PRODUCT"]
            use_fallback: true
            min_entity_length: 2
        - type: "SummaryExtractor"
          config:
            summary_sentences: 3
            min_sentence_length: 10
            max_sentence_length: 500
            include_key_phrases: true
            include_statistics: true

    # Customer support data processing
    - name: "customer_support_processing"
      description: "Optimized strategy for customer support system"
      directory_config:
        recursive: false
        include_patterns: ["*.csv", "*.txt"]
        exclude_patterns: ["*.tmp", ".*"]
        allowed_extensions: [".csv", ".txt"]
        max_files: 500
        follow_symlinks: false
      parsers:
        - type: "CSVParser_Pandas"
          file_extensions: [".csv", ".CSV"]
          config:
            content_fields: ["description"]
            metadata_fields: ["ticket_id", "customer_name", "customer_email", "priority", "category", "issue_type", "status", "agent_name"]
            priority_mapping:
              "Critical": 1
              "High": 2
              "Medium": 3
              "Low": 4
        - type: "TextParser_Python"
          file_extensions: [".txt", ".text"]
          config:
            chunk_size: 800
            chunk_overlap: 100
            chunk_strategy: "sentences"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: false
            min_chunk_size: 50
            preserve_line_breaks: true
            strip_empty_lines: true
            detect_structure: true
      extractors:
        - type: "EntityExtractor"
          config:
            entity_types: ["PERSON", "ORG", "GPE", "DATE", "PERCENT", "PRODUCT"]
            use_fallback: true
            min_entity_length: 2
        - type: "PatternExtractor"
          config:
            predefined_patterns: ["email", "phone", "url", "ip_address"]
            include_context: true
        - type: "SummaryExtractor"
          config:
            summary_sentences: 2
            min_sentence_length: 10
            max_sentence_length: 300
            include_key_phrases: true
            include_statistics: false

    # Code documentation processing
    - name: "code_documentation_processing"
      description: "Optimized strategy for code documentation"
      directory_config:
        recursive: true
        include_patterns: ["*.md", "*.py", "*.txt", "*.js", "*.ts"]
        exclude_patterns: ["__pycache__", "*.pyc", "node_modules/*", ".git/*"]
        allowed_extensions: [".md", ".py", ".txt", ".js", ".ts", ".jsx", ".tsx"]
        max_files: 2000
        follow_symlinks: false
      parsers:
        - type: "MarkdownParser_LlamaIndex"
          file_extensions: [".md", ".markdown"]
          config:
            chunk_size: 1200
            chunk_overlap: 150
            chunk_strategy: "headings"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: true
            min_chunk_size: 80
            extract_headings: true
            extract_code_blocks: true
            preserve_formatting: false
        - type: "TextParser_Python"
          file_extensions: [".py", ".txt", ".js", ".ts", ".jsx", ".tsx"]
          config:
            chunk_size: 1000
            chunk_overlap: 100
            chunk_strategy: "characters"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: false
            min_chunk_size: 60
            preserve_line_breaks: true
            strip_empty_lines: false
            detect_structure: true
      extractors:
        - type: "HeadingExtractor"
          config:
            max_level: 4
            include_hierarchy: true
            extract_outline: true
        - type: "PatternExtractor"
          config:
            predefined_patterns: ["url", "file_path"]
            include_context: true
        - type: "KeywordExtractor"
          config:
            algorithm: "yake"
            max_keywords: 15
            min_keyword_length: 3

    # Business reports processing
    - name: "business_reports_processing"
      description: "Optimized strategy for business reports analysis"
      directory_config:
        recursive: true
        include_patterns: ["*.pdf", "*.docx", "*.xlsx"]
        exclude_patterns: ["*.tmp", "~$*"]
        allowed_extensions: [".pdf", ".docx", ".xlsx"]
        max_files: 500
        follow_symlinks: false
      parsers:
        - type: "PDFParser_LlamaIndex"
          file_extensions: [".pdf", ".PDF"]
          config:
            chunk_size: 1800
            chunk_overlap: 250
            chunk_strategy: "pages"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: false
            min_chunk_size: 200
            extract_metadata: true
            combine_pages: true
            extract_outline: true
        - type: "DocxParser_LlamaIndex"
          file_extensions: [".docx", ".DOCX"]
          config:
            chunk_size: 1600
            chunk_overlap: 200
            chunk_strategy: "sections"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: true
            min_chunk_size: 150
            extract_metadata: true
            extract_tables: true
        - type: "ExcelParser_LlamaIndex"
          file_extensions: [".xlsx", ".XLSX"]
          config:
            chunk_size: 500
            extract_metadata: true
      extractors:
        - type: "TableExtractor"
          config:
            output_format: "dict"
            extract_headers: true
            min_rows: 3
        - type: "PatternExtractor"
          config:
            custom_patterns:
              - name: "currency_amount"
                pattern: "\\$[0-9]{1,3}(?:,[0-9]{3})*(?:\\.[0-9]{2})?"
                description: "USD currency amounts"
              - name: "percentage"
                pattern: "\\b\\d{1,3}(?:\\.\\d{1,2})?%"
                description: "Percentage values"
        - type: "EntityExtractor"
          config:
            entity_types: ["ORG", "MONEY", "PERCENT", "DATE", "PRODUCT"]
            use_fallback: true
            confidence_threshold: 0.7

    # Aircraft operations manual processing
    - name: "aircraft_operations_processing"
      description: "Strategy for aircraft operations manual analysis (737 FCOM)"
      directory_config:
        recursive: true
        include_patterns: ["*.pdf"]
        exclude_patterns: ["*.tmp", ".*"]
        allowed_extensions: [".pdf", ".PDF"]
        max_files: 100
        follow_symlinks: false
      parsers:
        - type: "PDFParser_LlamaIndex"
          file_extensions: [".pdf", ".PDF"]
          config:
            chunk_size: 2000
            chunk_overlap: 300
            chunk_strategy: "pages"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: true
            min_chunk_size: 200
            extract_metadata: true
            extract_page_structure: true
            combine_pages: false
            page_separator: "\n\n=== Page Break ===\n\n"
            min_text_length: 50
            include_page_numbers: true
            extract_outline: true
      extractors:
        - type: "HeadingExtractor"
          config:
            max_level: 4
            include_hierarchy: true
            extract_outline: true
            min_heading_length: 3
        - type: "PatternExtractor"
          config:
            custom_patterns:
              - name: "flight_level"
                pattern: "FL\\d{2,3}"
                description: "Flight levels"
              - name: "speed"
                pattern: "\\d+\\s*(?:kts|KIAS|KTAS|M\\.\\d+)"
                description: "Aircraft speeds"
              - name: "weight"
                pattern: "\\d+(?:,\\d{3})*\\s*(?:lbs?|kg)"
                description: "Aircraft weights"
              - name: "altitude"
                pattern: "\\d+(?:,\\d{3})*\\s*(?:ft|feet|FL)"
                description: "Altitudes"
            include_context: true
        - type: "EntityExtractor"
          config:
            entity_types: ["ORG", "FAC", "LOC", "PRODUCT"]
            use_fallback: true
            confidence_threshold: 0.7
        - type: "TableExtractor"
          config:
            output_format: "dict"
            extract_headers: true
            min_rows: 2

    # News analysis processing with HTML
    - name: "news_analysis_processing"
      description: "Optimized strategy for news article analysis"
      directory_config:
        recursive: true
        include_patterns: ["*.html", "*.htm", "*.txt"]
        exclude_patterns: ["*.tmp", ".*"]
        allowed_extensions: [".html", ".htm", ".txt"]
        max_files: 1000
        follow_symlinks: false
      parsers:
        # HTML files processed as text (HTMLParser not available)
        - type: "TextParser_Python"
          file_extensions: [".html", ".htm"]
          config:
            chunk_size: 1400
            chunk_overlap: 180
            chunk_strategy: "paragraphs"
            respect_sentence_boundaries: true
            respect_paragraph_boundaries: true
            min_chunk_size: 100
            extract_metadata: true
        - type: "TextParser_Python"
          file_extensions: [".txt"]
          config:
            chunk_size: 1400
            chunk_overlap: 180
            chunk_strategy: "paragraphs"
            extract_metadata: true
      extractors:
        - type: "EntityExtractor"
          config:
            entity_types: ["PERSON", "ORG", "GPE", "DATE", "MONEY", "EVENT"]
            use_fallback: true
            confidence_threshold: 0.7
        - type: "DateTimeExtractor"
          config:
            fuzzy_parsing: true
            extract_relative: true
            date_format: "ISO"
        - type: "SummaryExtractor"
          config:
            summary_sentences: 3
            algorithm: "textrank"
            include_key_phrases: true

    # Generic multi-format processing with all parsers
    - name: "multi_format_advanced"
      description: "Advanced multi-format document processing"
      directory_config:
        recursive: true
        include_patterns: ["*"]
        exclude_patterns: ["*.tmp", ".*", "__pycache__/*", "node_modules/*", ".git/*"]
        allowed_extensions: []  # Accept all extensions
        max_files: 10000
        follow_symlinks: false
      parsers:
        # PDF parser
        - type: "PDFParser_LlamaIndex"
          file_extensions: [".pdf", ".PDF"]
          config:
            chunk_strategy: "semantic"
            chunk_size: 1500
            chunk_overlap: 200
            extract_metadata: true
        # Word documents
        - type: "DocxParser_LlamaIndex"
          file_extensions: [".docx", ".DOCX"]
          config:
            chunk_size: 1500
            chunk_overlap: 200
            extract_metadata: true
        # Excel spreadsheets
        - type: "ExcelParser_LlamaIndex"
          file_extensions: [".xlsx", ".XLSX", ".xls", ".XLS"]
          config:
            chunk_size: 500
            extract_metadata: true
        # CSV files
        - type: "CSVParser_LlamaIndex"
          file_extensions: [".csv", ".tsv", ".CSV", ".TSV"]
          config:
            chunk_size: 500
            chunk_overlap: 50
            extract_metadata: true
        # Markdown files
        - type: "MarkdownParser_LlamaIndex"
          file_extensions: [".md", ".markdown", ".mdown", ".mkd"]
          config:
            chunk_size: 1200
            chunk_overlap: 150
            extract_metadata: true
        # HTML, JSON, XML files processed as text (specialized parsers not available)
        - type: "TextParser_Python"
          file_extensions: [".html", ".htm", ".xhtml", ".json", ".jsonl", ".xml", ".XML"]
          config:
            chunk_size: 1200
            chunk_overlap: 150
            extract_metadata: true
        # Plain text as fallback (catches everything else)
        - type: "TextParser_LlamaIndex"
          file_extensions: [".txt", ".text", ".log", ".py", ".js", ".ts", ".java", ".cpp", ".c", ".h", ".hpp", ".cs", ".rb", ".go", ".rs", ".swift", ".kt", ".scala", ".r", ".m", ".sh", ".bash", ".zsh", ".fish", ".ps1", ".bat", ".cmd"]
          config:
            chunk_size: 1000
            chunk_overlap: 150
            extract_metadata: true
      extractors:
        - type: "ContentStatisticsExtractor"
          config:
            include_readability: true
            include_vocabulary: true
            include_structure: true
        - type: "EntityExtractor"
          config:
            entity_types: ["PERSON", "ORG", "GPE", "DATE", "PRODUCT", "MONEY", "PERCENT", "EVENT"]
            use_fallback: true
        - type: "KeywordExtractor"
          config:
            algorithm: "yake"
            max_keywords: 20
            min_keyword_length: 3
