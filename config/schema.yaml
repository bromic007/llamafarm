# yaml-language-server: $schema=http://json-schema.org/draft-07/schema#

$schema: http://json-schema.org/draft-07/schema#
title: LlamaFarm Config
type: object
required:
  - version
  - name
  - namespace
  - runtime
properties:
  version:
    type: string
    enum: [v1]
    default: v1
    description: Config version, must be "v1"
  name:
    type: string
    description: Project name
    example: my-project
  namespace:
    type: string
    description: Project namespace
    example: my-namespace
  prompts:
    type: array
    description: List of named prompt sets
    items:
      type: object
      required:
        - name
        - messages
      properties:
        name:
          type: string
          pattern: '^[a-z][a-z0-9_]*$'
          description: Unique prompt set identifier
        messages:
          type: array
          description: List of messages in this prompt set
          items:
            type: object
            required:
              - role
              - content
            properties:
              role:
                type: string
                description: "Message role (e.g., \"system\", \"user\", \"assistant\")"
              content:
                type: string
                description: Message content
          default: []
    default: []

  rag:
    $ref: '../rag/schema.yaml'

  datasets:
    type: array
    description: List of dataset configurations
    items:
      type: object
      required:
        - name
        - files
        - data_processing_strategy
        - database
      properties:
        name:
          type: string
          description: Dataset name
        data_processing_strategy:
          type: string
          description: RAG data processing strategy to use for the dataset
        database:
          type: string
          description: RAG database to use for the dataset
        files:
          type: array
          description: List of file hashes
          items:
            type: string
            description: sha256 of the file content (e.g., "2b3e321d021e5c625a4a003f0624801fa46faab59b530caddcd65a5c106b8a17")
          default: []
    default: []

  runtime:
    type: object
    properties:
      default_model:
        type: string
        description: Name of the default model to use (references a model name in the models list). If not specified, uses first model.

      models:
        type: array
        description: List of model configurations for multi-model support
        items:
          type: object
          required:
            - name
            - provider
            - model
          properties:
            name:
              type: string
              description: Model identifier (unique name)
            description:
              type: string
              description: Human-readable description of this model configuration
            provider:
              type: string
              enum: [openai, ollama, lemonade]
              description: Runtime provider for this model
            model:
              type: string
              description: Model name or ID
            base_url:
              type: string
              description: Base URL for the provider
            api_key:
              type: string
              description: API key for the provider
            instructor_mode:
              type: string
              description: "Instructor mode to use for structured output (e.g., tools, json, md_json)"
            prompt_format:
              type: string
              enum: [structured, unstructured]
              description: Prompt formatting pipeline (structured uses Instructor; unstructured sends freeform prompts)
            model_api_parameters:
              type: object
              description: Additional parameters passed to the API provider
              additionalProperties: true
            provider_config:
              type: object
              description: "Provider-specific configuration (e.g., lemonade settings, ollama options)"
              default: {}
              additionalProperties: true
            prompts:
              type: array
              description: List of prompt set names to use for this model (merged in order)
              items:
                type: string
              default: []

  mcp:
    type: object
    description: Model Context Protocol (MCP) client configuration
    properties:
      servers:
        type: array
        description: List of MCP Servers available to the project during inference
        items:
          type: object
          required:
            - name
            - transport
          properties:
            name:
              type: string
              description: MCP server identifier
            transport:
              type: string
              enum: [stdio, http, sse]
              description: Connection transport to the MCP server
            # stdio transport
            command:
              type: string
              description: Command/binary to launch the MCP server (stdio)
            args:
              type: array
              description: Optional args for the stdio command
              items:
                type: string
            env:
              type: object
              description: Environment variables for the stdio command
              additionalProperties:
                type: string
            # http transport
            base_url:
              type: string
              description: Base URL of the MCP server (http)
            headers:
              type: object
              description: HTTP headers for the MCP server
              additionalProperties:
                type: string
              example:
                Authorization: Bearer ${env:MCP_SERVER_TOKEN}
