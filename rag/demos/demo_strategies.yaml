# Demo Strategies Configuration
# Uses the new unified strategy schema format
# This file demonstrates the power of the strategy system for quick setup

strategies:
  # =============================================================================
  # DEMO 1: RESEARCH PAPERS STRATEGY
  # =============================================================================
  research_papers_demo:
    name: "research_papers_demo"
    description: "Optimized strategy for academic research paper analysis demo"
    tags: ["demo", "research", "academic", "papers"]
    use_cases: 
      - "Academic research analysis"
      - "Literature review"
      - "Paper summarization"
    
    components:
      parser:
        type: "TextParser_Python"
        config:
          chunk_size: 1500  # Larger chunks for academic papers
          chunk_overlap: 200  # Good overlap for academic context
          chunk_strategy: sentences  # Sentence-aware chunking for research papers
          clean_text: true
          extract_metadata: true
      
      extractors:
        - type: "ContentStatisticsExtractor"
          priority: 100
          config:
            include_readability: true
            include_vocabulary: true
            include_structure: true
            include_sentiment_indicators: true
        
        - type: "EntityExtractor"
          priority: 90
          config:
            entity_types: ["PERSON", "ORG", "GPE", "DATE", "PERCENT", "PRODUCT"]
            use_fallback: true
            min_entity_length: 2
        
        - type: "SummaryExtractor"
          priority: 80
          config:
            summary_sentences: 3
            min_sentence_length: 10
            max_sentence_length: 500
            include_key_phrases: true
            include_statistics: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 3
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "research_papers"
          persist_directory: "./demos/vectordb/research_papers"
          distance_function: "cosine"  # Best for semantic similarity
      
      retrieval_strategy:
        type: "BasicSimilarityStrategy"
        config:
          distance_metric: "cosine"
          top_k: 3

  # =============================================================================
  # DEMO 2: CUSTOMER SUPPORT STRATEGY
  # =============================================================================
  customer_support_demo:
    name: "customer_support_demo"
    description: "Optimized strategy for customer support system demo"
    tags: ["demo", "support", "customer-service", "helpdesk"]
    use_cases:
      - "Customer support ticketing"
      - "Knowledge base search"
      - "Support automation"
    
    components:
      parser:
        type: "CSVParser_Pandas"
        config:
          chunk_size: 800  # Optimal for customer support knowledge base
          chunk_overlap: 100  # Maintain context between chunks
          chunk_strategy: rows  # Process CSV row by row
          extract_metadata: true
      
      extractors:
        - type: "EntityExtractor"
          priority: 95
          config:
            entity_types: ["PERSON", "ORG", "GPE", "DATE", "PERCENT", "PRODUCT"]
            use_fallback: true
            min_entity_length: 2
        
        - type: "PatternExtractor"
          priority: 90
          config:
            predefined_patterns: ["email", "phone", "url", "ip_address"]
            include_context: true
        
        - type: "SummaryExtractor"
          priority: 85
          config:
            summary_sentences: 2
            min_sentence_length: 10
            max_sentence_length: 300
            include_key_phrases: true
            include_statistics: false
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 5
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "customer_support"
          persist_directory: "./demos/vectordb/customer_support"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "MetadataFilteredStrategy"
        config:
          top_k: 5
          filters:
            priority: ["Critical", "High"]
          filter_mode: "post"
          fallback_multiplier: 2

  # =============================================================================
  # DEMO 3: CODE DOCUMENTATION STRATEGY
  # =============================================================================
  code_documentation_demo:
    name: "code_documentation_demo"
    description: "Optimized strategy for code documentation demo"
    tags: ["demo", "code", "documentation", "technical"]
    use_cases:
      - "API documentation search"
      - "Code examples retrieval"
      - "Technical documentation"
    
    components:
      parser:
        type: "MarkdownParser_Python"
        config:
          chunk_size: 1200  # Medium chunks for code documentation
          chunk_overlap: 150
          chunk_strategy: sections  # Use markdown structure for documentation
          extract_metadata: true
          extract_code_blocks: true
          extract_links: true
      
      extractors:
        - type: "HeadingExtractor"
          priority: 100
          config:
            max_level: 4
            include_hierarchy: true
            extract_outline: true
        
        - type: "PatternExtractor"
          priority: 90
          config:
            predefined_patterns: ["url", "file_path"]
            include_context: true
        
        - type: "YAKEExtractor"
          priority: 80
          config:
            max_keywords: 15
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 4
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "code_documentation"
          persist_directory: "./demos/vectordb/code_documentation"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "HybridUniversalStrategy"
        config:
          strategies:
            - type: "BasicSimilarityStrategy"
              weight: 0.6
              config:
                top_k: 10
                distance_metric: "cosine"
            
            - type: "MultiQueryStrategy"
              weight: 0.4
              config:
                num_queries: 3
                top_k: 10
                aggregation_method: "weighted"
          
          combination_method: "weighted_average"
          final_k: 5

  # =============================================================================
  # DEMO 4: NEWS ANALYSIS STRATEGY
  # =============================================================================
  news_analysis_demo:
    name: "news_analysis_demo"
    description: "Optimized strategy for news article analysis demo"
    tags: ["demo", "news", "analysis", "media"]
    use_cases:
      - "News article analysis"
      - "Trend detection"
      - "Content summarization"
    
    components:
      parser:
        type: "TextParser_Python"
        config:
          chunk_size: 1400  # Good size for news articles
          chunk_overlap: 180
          chunk_strategy: paragraphs  # Use paragraph chunking for news
          extract_metadata: true
          clean_text: true
      
      extractors:
        - type: "EntityExtractor"
          priority: 100
          config:
            entity_types: ["PERSON", "ORG", "GPE", "DATE", "MONEY", "EVENT"]
            use_fallback: true
            confidence_threshold: 0.7
        
        - type: "DateTimeExtractor"
          priority: 95
          config:
            fuzzy_parsing: true
            extract_relative: true
            date_format: "ISO"
        
        - type: "SummaryExtractor"
          priority: 85
          config:
            summary_sentences: 3
            algorithm: "textrank"
            include_key_phrases: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 5
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "news_analysis"
          persist_directory: "./demos/vectordb/news_analysis"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "RerankedStrategy"
        config:
          initial_k: 20
          final_k: 5
          rerank_factors:
            similarity_weight: 0.5
            recency_weight: 0.3
            metadata_weight: 0.2
          normalize_scores: true
    
    monitoring:
      metrics_enabled: true
      log_level: "INFO"

  # =============================================================================
  # DEMO 5: BUSINESS REPORTS STRATEGY
  # =============================================================================
  business_reports_demo:
    name: "business_reports_demo"
    description: "Optimized strategy for business reports analysis demo"
    tags: ["demo", "business", "reports", "analytics"]
    use_cases:
      - "Financial report analysis"
      - "Business intelligence"
      - "Market analysis"
    
    components:
      parser:
        type: "PDFParser_PyPDF2"
        config:
          chunk_size: 1800  # Larger chunks for business reports
          chunk_overlap: 250
          chunk_strategy: sentences
          extract_metadata: true
      
      extractors:
        - type: "TableExtractor"
          priority: 100
          config:
            output_format: "dict"
            extract_headers: true
            min_rows: 3
        
        - type: "PatternExtractor"
          priority: 95
          config:
            custom_patterns:
              - name: "currency_amount"
                pattern: "\\$[0-9]{1,3}(?:,[0-9]{3})*(?:\\.[0-9]{2})?"
                description: "USD currency amounts"
              - name: "percentage"
                pattern: "\\b\\d{1,3}(?:\\.\\d{1,2})?%"
                description: "Percentage values"
        
        - type: "SentimentExtractor"
          priority: 90
          config:
            analyze_business_tone: true
            extract_confidence: true
            categories: ["positive", "negative", "neutral", "mixed"]
        
        - type: "EntityExtractor"
          priority: 88
          config:
            entity_types: ["ORG", "MONEY", "PERCENT", "DATE", "PRODUCT"]
            use_fallback: true
            confidence_threshold: 0.7
        
        - type: "StatisticsExtractor"
          priority: 85
          config:
            include_readability: false
            include_vocabulary: false
            include_structure: true
            include_sentiment_indicators: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 4
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "business_reports"
          persist_directory: "./demos/vectordb/business_reports"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "MetadataFilteredStrategy"
        config:
          top_k: 10
          filter_mode: "pre"
          fallback_multiplier: 2

  # =============================================================================
  # DEMO 6: DOCUMENT MANAGEMENT STRATEGY
  # =============================================================================
  document_management_demo:
    name: "document_management_demo"
    description: "Strategy for document lifecycle management demo"
    tags: ["demo", "management", "operations", "vector-db"]
    use_cases:
      - "Document lifecycle operations"
      - "Vector database management"
      - "Deduplication testing"
    
    components:
      parser:
        type: "TextParser_Python"
        config:
          chunk_size: null  # No chunking for document lifecycle demo
          chunk_strategy: characters  # Strategy doesn't matter when chunk_size is null
          respect_sentence_boundaries: true
          respect_paragraph_boundaries: false
          min_chunk_size: 50  # Ignored when chunk_size is null
          detect_structure: true
          preserve_line_breaks: true
          strip_empty_lines: true
          encoding: "auto"
      
      extractors:
        - type: "EntityExtractor"
          priority: 95
          config:
            entity_types: ["PERSON", "ORG", "DATE", "VERSION"]
            use_fallback: true
        
        - type: "PatternExtractor"
          priority: 90
          config:
            predefined_patterns: ["version", "date"]
            include_context: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 1
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "document_management"
          persist_directory: "./demos/vectordb/document_management"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "BasicSimilarityStrategy"
        config:
          top_k: 5

# =============================================================================
# STRATEGY TEMPLATES
# =============================================================================

  # =============================================================================
  # DEMO 7: AIRCRAFT OPERATIONS STRATEGY
  # =============================================================================
  aircraft_operations_demo:
    name: "aircraft_operations_demo"
    description: "Strategy for aircraft operations manual analysis (737 FCOM)"
    tags: ["demo", "aviation", "technical", "operations", "pdf"]
    use_cases:
      - "Aircraft operations manual search"
      - "Technical procedure retrieval"
      - "Safety documentation analysis"
    
    components:
      parser:
        type: "PDFParser_PyPDF2"
        config:
          chunk_size: 2000  # Larger chunks for technical manual
          chunk_overlap: 300  # Good overlap for procedures
          chunk_strategy: sentences
          extract_tables: true  # Extract tables for procedures
          extract_metadata: true
          ocr_enabled: false
          min_chunk_size: 200
          extract_page_structure: true
          combine_pages: false  # Keep pages separate for reference
          page_separator: "\n\n=== Page Break ===\n\n"
          min_text_length: 50
          include_page_numbers: true
          extract_outline: true  # Important for navigation
          fallback_strategies: ["llama_pdf_reader", "llama_pymupdf_reader", "direct_pymupdf", "pypdf2_fallback"]
      
      extractors:
        - type: "HeadingExtractor"
          config:
            max_level: 4
            include_hierarchy: true
            extract_outline: true
            min_heading_length: 3
        
        - type: "PatternExtractor"
          config:
            custom_patterns:
              - name: "flight_level"
                pattern: "FL\\d{2,3}"
                description: "Flight levels"
              - name: "speed"
                pattern: "\\d+\\s*(?:kts|KIAS|KTAS|M\\.\\d+)"
                description: "Aircraft speeds"
              - name: "weight"
                pattern: "\\d+(?:,\\d{3})*\\s*(?:lbs?|kg)"
                description: "Aircraft weights"
              - name: "altitude"
                pattern: "\\d+(?:,\\d{3})*\\s*(?:ft|feet|FL)"
                description: "Altitudes"
            include_context: true
        
        - type: "EntityExtractor"
          config:
            entity_types: ["ORG", "FAC", "LOC", "PRODUCT"]
            use_fallback: true
            confidence_threshold: 0.7
        
        - type: "TableExtractor"
          config:
            output_format: "dict"
            extract_headers: true
            min_rows: 2
        
        - type: "StatisticsExtractor"
          config:
            include_structure: true
            include_readability: false
            include_vocabulary: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 3  # Smaller batch for large chunks
          timeout: 90  # Longer timeout for technical content
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "aircraft_operations"
          persist_directory: "./demos/vectordb/aircraft_operations"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "RerankedStrategy"
        config:
          initial_k: 15
          final_k: 5
          rerank_factors:
            similarity_weight: 0.6
            recency_weight: 0.1
            metadata_weight: 0.3  # Important for page/section context
          normalize_scores: true

  # ==============================================================================
  # TEST STRATEGY FOR CLI TESTING  
  # ==============================================================================
  test_cli_strategy:
    name: "test_cli_strategy"
    description: "Test strategy for automated CLI testing"
    tags: ["test", "cli"]
    use_cases:
      - "CLI testing"
      - "Integration testing"
    
    components:
      parser:
        type: "MarkdownParser_Python"
        config:
          chunk_size: 1000
          chunk_overlap: 100
          chunk_strategy: sections
      
      extractors:
        - type: "KeywordExtractor"
          config:
            max_keywords: 5
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 4
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "test_cli_collection"
          persist_directory: "./vectordb/test_cli_collection"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "BasicSimilarityStrategy"
        config:
          top_k: 5

strategy_templates:
  minimal_demo:
    name: "minimal_demo"
    description: "Minimal configuration for quick demos"
    tags: ["template", "minimal", "quick-start"]
    use_cases: ["Quick prototyping"]
    components:
      parser:
        type: "TextParser_Python"
        config:
          chunk_size: 1000
          chunk_overlap: 200
          chunk_strategy: characters
          respect_sentence_boundaries: true
          min_chunk_size: 50
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 10
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "demo"
          persist_directory: "./demos/vectordb/demo"
          distance_function: "cosine"
      retrieval_strategy:
        type: "BasicSimilarityStrategy"
        config:
          top_k: 5

  # =============================================================================
  # DEMO 8: ADVANCED PDF WITH LLAMAINDEX
  # =============================================================================
  advanced_pdf_llamaindex:
    name: "advanced_pdf_llamaindex"
    description: "Advanced PDF processing using LlamaIndex parser with multiple fallback strategies"
    tags: ["demo", "llamaindex", "pdf", "advanced"]
    use_cases:
      - "Complex PDF document analysis"
      - "Research papers with tables and images"
      - "Technical documentation"
    
    components:
      parser:
        type: "PDFParser_LlamaIndex"
        config:
          chunk_size: 1500
          chunk_overlap: 200
          chunk_strategy: "semantic"  # Advanced semantic chunking
          extract_metadata: true
          extract_images: true
          extract_tables: true
          fallback_strategies: 
            - "llama_pdf_reader"
            - "llama_pymupdf_reader"
            - "direct_pymupdf"
            - "pypdf2_fallback"
      
      extractors:
        - type: "TableExtractor"
          priority: 100
          config:
            output_format: "dict"
            extract_headers: true
        
        - type: "EntityExtractor"
          priority: 95
          config:
            entity_types: ["PERSON", "ORG", "DATE", "PRODUCT", "TECH"]
            use_fallback: true
        
        - type: "SummaryExtractor"
          priority: 90
          config:
            summary_sentences: 5
            include_key_phrases: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 4
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "advanced_pdf_docs"
          persist_directory: "./demos/vectordb/advanced_pdf"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "RerankedStrategy"
        config:
          initial_top_k: 20
          final_top_k: 5
          rerank_factors:
            similarity_score: 0.6
            recency: 0.2
            metadata_match: 0.2

  # =============================================================================
  # DEMO 9: MARKDOWN DOCUMENTATION WITH LLAMAINDEX
  # =============================================================================
  markdown_docs_llamaindex:
    name: "markdown_docs_llamaindex"
    description: "Markdown documentation processing with LlamaIndex heading-aware chunking"
    tags: ["demo", "llamaindex", "markdown", "documentation"]
    use_cases:
      - "Technical documentation"
      - "README files"
      - "API documentation"
    
    components:
      parser:
        type: "MarkdownParser_LlamaIndex"
        config:
          chunk_size: 1200
          chunk_overlap: 150
          chunk_strategy: "headings"  # Split by markdown headings
          extract_metadata: true
          extract_code_blocks: true
          extract_tables: true
          extract_links: true
          preserve_structure: true
      
      extractors:
        - type: "CodeExtractor"
          priority: 100
          config:
            languages: ["python", "javascript", "bash", "yaml"]
            extract_functions: true
            extract_classes: true
        
        - type: "LinkExtractor"
          priority: 95
          config:
            extract_internal: true
            extract_external: true
            validate_urls: false
        
        - type: "SummaryExtractor"
          priority: 90
          config:
            summary_sentences: 3
            include_key_phrases: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 5
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "markdown_docs"
          persist_directory: "./demos/vectordb/markdown_docs"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "HybridUniversalStrategy"
        config:
          strategies:
            - type: "BasicSimilarityStrategy"
              weight: 0.5
              config:
                top_k: 10
            - type: "MetadataFilteredStrategy"
              weight: 0.5
              config:
                top_k: 10
          aggregation_method: "weighted"
          final_top_k: 5

  # =============================================================================
  # DEMO 10: EXCEL DATA ANALYSIS WITH LLAMAINDEX
  # =============================================================================
  excel_analysis_llamaindex:
    name: "excel_analysis_llamaindex"
    description: "Excel data processing with LlamaIndex multi-sheet support"
    tags: ["demo", "llamaindex", "excel", "data-analysis"]
    use_cases:
      - "Financial reports"
      - "Business metrics"
      - "Data analysis"
    
    components:
      parser:
        type: "ExcelParser_LlamaIndex"
        config:
          chunk_size: 1000  # Rows per chunk
          chunk_strategy: "rows"
          sheets: null  # Process all sheets
          combine_sheets: false
          extract_metadata: true
          extract_formulas: true
          header_row: 0
          na_values: ["", "NA", "N/A", "null", "None"]
      
      extractors:
        - type: "TableExtractor"
          priority: 100
          config:
            output_format: "dict"
            extract_headers: true
            min_rows: 2
        
        - type: "PatternExtractor"
          priority: 95
          config:
            custom_patterns:
              - name: "currency_amount"
                pattern: "\\$[0-9]{1,3}(?:,[0-9]{3})*(?:\\.[0-9]{2})?"
                description: "Currency amounts"
              - name: "percentage"
                pattern: "\\b\\d{1,3}(?:\\.\\d{1,2})?%"
                description: "Percentages"
        
        - type: "StatisticsExtractor"
          priority: 90
          config:
            include_structure: true
            include_sentiment_indicators: false
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 3
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "excel_data"
          persist_directory: "./demos/vectordb/excel_data"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "MetadataFilteredStrategy"
        config:
          top_k: 10
          filter_mode: "pre"
          fallback_multiplier: 2

  # =============================================================================
  # DEMO 11: MULTI-FORMAT WITH LLAMAINDEX TEXT PARSER
  # =============================================================================
  multiformat_llamaindex:
    name: "multiformat_llamaindex"
    description: "Multi-format text processing with LlamaIndex advanced text parser"
    tags: ["demo", "llamaindex", "text", "multi-format"]
    use_cases:
      - "Code files"
      - "Configuration files"
      - "Log files"
      - "Plain text documents"
    
    components:
      parser:
        type: "TextParser_LlamaIndex"
        config:
          chunk_size: 1200
          chunk_overlap: 100
          chunk_strategy: "semantic"  # Smart semantic chunking
          extract_metadata: true
          preserve_code_structure: true
          detect_language: true
          include_prev_next_rel: true  # Include chunk relationships
      
      extractors:
        - type: "CodeExtractor"
          priority: 100
          config:
            languages: ["python", "javascript", "java", "go", "rust"]
            extract_functions: true
            extract_classes: true
            extract_imports: true
        
        - type: "PatternExtractor"
          priority: 95
          config:
            custom_patterns:
              - name: "log_level"
                pattern: "\\b(ERROR|WARN|INFO|DEBUG)\\b"
                description: "Log levels"
              - name: "timestamp"
                pattern: "\\d{4}-\\d{2}-\\d{2}[T ]\\d{2}:\\d{2}:\\d{2}"
                description: "ISO timestamps"
        
        - type: "EntityExtractor"
          priority: 90
          config:
            entity_types: ["DATE", "TIME", "VERSION", "FILE", "PATH"]
            use_fallback: true
      
      embedder:
        type: "OllamaEmbedder"
        config:
          model: "nomic-embed-text"
          batch_size: 5
          timeout: 60
      
      vector_store:
        type: "ChromaStore"
        config:
          collection_name: "multiformat_docs"
          persist_directory: "./demos/vectordb/multiformat"
          distance_function: "cosine"
      
      retrieval_strategy:
        type: "MultiQueryStrategy"
        config:
          num_queries: 3
          aggregation_method: "reciprocal_rank_fusion"
          query_variations:
            - "original"
            - "expanded"
            - "simplified"
          top_k: 5

